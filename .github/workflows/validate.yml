name: Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Validate project structure
      run: |
        echo "Validating project structure..."
        test -f README.md && echo "README.md exists" || exit 1
        test -f requirements.txt && echo "requirements.txt exists" || exit 1
        test -f setup.py && echo "setup.py exists" || exit 1
        test -d src && echo "src directory exists" || exit 1
        test -d docs && echo "docs directory exists" || exit 1
        test -d tests && echo "tests directory exists" || exit 1
        echo "All structure validations passed"
    
    - name: Count Python files
      run: |
        echo "Counting Python files..."
        PY_COUNT=$(find src -name "*.py" | wc -l)
        echo "Found $PY_COUNT Python files in src"
        test $PY_COUNT -gt 0 && echo "Python files found" || exit 1
    
    - name: Count SQL files
      run: |
        echo "Counting SQL files..."
        SQL_COUNT=$(find sql -name "*.sql" 2>/dev/null | wc -l)
        echo "Found $SQL_COUNT SQL files"
        test $SQL_COUNT -gt 0 && echo "SQL files found" || exit 1

  docker-check:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Validate Docker Compose
      run: |
        cd infrastructure/docker
        docker-compose config > /dev/null && echo "docker-compose.yml is valid"
